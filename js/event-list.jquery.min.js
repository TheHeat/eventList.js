function nowISO(){var a=new Date,b=a.toISOString();return b}function formatDate(a){var b="";switch(a){case 1:case 21:case 31:b="st";break;case 2:case 22:b="nd";break;case 3:case 23:b="rd";break;default:b="th"}return a+b}function formatTime(a,b){return 12>a?a+":"+pad(b)+"am":a-12+":"+pad(b)+"pm"}function pad(a){return 10>a?"0"+a:a}var d_names=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),m_names=new Array("January","February","March","April","May","June","July","August","September","October","November","December");$.fn.eventList=function(a){var b={timeMin:nowISO(),singleEvents:!0,orderBy:"startTime"},c=$.extend({},b,a);console.log("PARAMS: ",c),calID=c.calID,linkContent=c.autolink;var d=c;delete d.calID,delete d.autolink;var e=$.param(d);$(this).html('<ol class="events-list"><li>Nothing to see here!</li></ol><div class="feed-links"></div>');var f="https://www.googleapis.com/calendar/v3/calendars/"+calID+"/events?"+e,g="http://www.google.com/calendar/embed?src="+calID,h="http://www.google.com/calendar/ical/"+calID+"/public/basic.ics";$.getJSON(f,function(a){$.each(a.items,function(a,b){0==a&&$(".events-list li").first().hide();var c=new Date(b.start.dateTime),d=c.getHours(),e=c.getMinutes(),f=c,g=d_names[c.getDay()]+" "+formatDate(c.getDate())+" "+m_names[c.getMonth()]+" "+c.getFullYear(),h='<time class="event-date" datetime="'+f+'">'+g+"</time>",i="";(0!=c.getHours()||0!=c.getMinutes())&&(tFormat=formatTime(d,e),i='<span class="event-time">'+tFormat+"</span>");var j=b.location,k='<a class="event-venue" href="http://maps.google.com/maps?q='+j+'"target="_blank">'+j+"</a>";eventDescription=b.description;var l='<h3 class="event-title" itemprop="name">'+b.summary+"</h3>";if(eventDescription)var m='<div class="event-description" itemprop="description">'+eventDescription+"</div>";else var m="";$(".events-list li").last().before('<li itemscope itemtype="http://schema.org/Event"><meta itemprop="startDate" content="'+f+'">'+h+l+m+i+k+"</li>")})});var i='<a href="'+h+'">iCal</a>',j='<a href="'+g+'">Google Calendar</a>';$(".feed-links").html(j+" | "+i)};